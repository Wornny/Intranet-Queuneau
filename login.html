<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Utilisateurs</title>
    <script>
        // Fonction pour lire le fichier CSV
        async function lireCSV(fichier) {
            const response = await fetch(fichier);
            const data = await response.text();
            const lignes = data.split('\n').slice(1);
            return lignes.map(ligne => {
                const [login, password, avatar] = ligne.split(',');
                return { login, password, avatar };
            });
        }

        // Fonction pour écrire dans le fichier CSV (simulé ici)
        function ecrireCSV(users) {
            // Simulation d'écriture dans le fichier CSV
            console.log('Fichier CSV mis à jour :', users);
        }

        // Fonction pour vérifier les informations de connexion
        async function verifierConnexion(login, password) {
            const users = await lireCSV('utilisateurs.csv');
            const user = users.find(u => u.login === login && u.password === password);
            return user;
        }

        // Fonction pour mettre à jour le mot de passe
        async function mettreAJourMotDePasse(login, nouveauMotDePasse) {
            const users = await lireCSV('utilisateurs.csv');
            const user = users.find(u => u.login === login);
            if (user) {
                user.password = nouveauMotDePasse;
                ecrireCSV(users);
                return true;
            }
            return false;
        }

        // Fonction pour gérer la connexion
        async function seConnecter() {
            const login = document.getElementById('login').value;
            const password = document.getElementById('password').value;
            const user = await verifierConnexion(login, password);
            if (user) {
                alert('Connexion réussie !');
                // Demander un nouveau mot de passe si le mot de passe est temporaire
                if (password.startsWith('temp')) {
                    const nouveauMotDePasse = prompt('Veuillez saisir un nouveau mot de passe :');
                    if (nouveauMotDePasse) {
                        await mettreAJourMotDePasse(login, nouveauMotDePasse);
                        alert('Mot de passe mis à jour !');
                    }
                }
            } else {
                alert('Échec de la connexion. Vérifiez vos informations.');
            }
        }
    </script>
</head>
<body>
    <h1>Se Connecter</h1>
    <form onsubmit="event.preventDefault(); seConnecter();">
        <label for="login">Login :</label>
        <input type="text" id="login" required><br>
        <label for="password">Mot de passe :</label>
        <input type="password" id="password" required><br>
        <button type="submit">Se Connecter</button>
    </form>
</body>
</html>
